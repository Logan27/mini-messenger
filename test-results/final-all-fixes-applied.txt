
[94m============================================================================[0m
[94m         ENHANCED MESSENGER API COMPREHENSIVE TEST SUITE (FIXED)[0m
[94m============================================================================[0m

Starting enhanced API tests at 23/10/2025  1:26:11.18
API URL: http://localhost:4000

[96m============================================================================[0m
[96mSECTION 1: HEALTH CHECK ENDPOINTS (4 endpoints)[0m
[96m============================================================================[0m

[1] Testing GET /health - Health Check
[92m✓ PASS[0m - Health check endpoint accessible [HTTP 200]

[2] Testing GET /health/detailed - Detailed Health Check
[92m✓ PASS[0m - Detailed health check accessible [HTTP 200]

[3] Testing GET /health/ready - Readiness Check
[92m✓ PASS[0m - Readiness check accessible [HTTP 200]

[4] Testing GET /health/live - Liveness Check
[92m✓ PASS[0m - Liveness check accessible [HTTP 200]

[96m============================================================================[0m
[96mSECTION 2: AUTHENTICATION ENDPOINTS (9 endpoints)[0m
[96m============================================================================[0m

[5] Testing POST /api/auth/register - User Registration
[92m✓ PASS[0m - User registration successful [HTTP 201]
  New User ID: 7c520fcd-607c-427d-9805-be228973753e

[6] Testing POST /api/auth/login - User Login
[92m✓ PASS[0m - User login successful [HTTP 200]
  Access Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiO...
  User ID: 7c520fcd-607c-427d-9805-be228973753e

[7] Testing GET /api/auth/me - Get Current User Profile
[92m✓ PASS[0m - User profile retrieved [HTTP 200]

[8] Testing POST /api/auth/refresh - Refresh Access Token
[92m✓ PASS[0m - Token refresh successful [HTTP 200]

[9] Testing POST /api/auth/forgot-password - Request Password Reset
[93m⚠ CONDITIONAL[0m - Password reset request processed [HTTP 200]

[10] Testing POST /api/auth/verify-email - Verify Email
[93m⚠ CONDITIONAL[0m - Email verification endpoint accessible [HTTP 400]

[11] Testing POST /api/auth/reset-password - Reset Password
[93m⚠ CONDITIONAL[0m - Password reset endpoint accessible [HTTP 400]

[12] Testing POST /api/auth/change-password - Change Password
[91m✗ FAIL[0m - Password change failed [HTTP 400]

[13] Testing POST /api/auth/resend-verification - Resend Verification
[93m⚠ CONDITIONAL[0m - Verification resend processed [HTTP 200]

[96m============================================================================[0m
[96mSECTION 3: USER MANAGEMENT ENDPOINTS (10 endpoints)[0m
[96m============================================================================[0m

[14] Testing GET /api/users/me - Get Current User Profile
[92m✓ PASS[0m - User profile retrieved [HTTP 200]

[15] Testing PUT /api/users/me - Update User Profile
[92m✓ PASS[0m - User profile updated [HTTP 200]

[16] Testing GET /api/users/search?q=test - Search Users
[92m✓ PASS[0m - User search successful [HTTP 200]

[17] Testing GET /api/users - List Users with Pagination
[92m✓ PASS[0m - User list retrieved [HTTP 200]

[18] Testing POST /api/users/me/avatar - Upload User Avatar
[92m✓ PASS[0m - Avatar uploaded successfully [HTTP 200]

[19] Testing DELETE /api/users/me - Delete User Account
[91m✗ FAIL[0m - Failed to delete account [HTTP 403]

[20] Testing POST /api/users/me/device-token - Add Device Token
[92m✓ PASS[0m - Device token added [HTTP 200]

[21] Testing DELETE /api/users/me/device-token - Remove Device Token
[92m✓ PASS[0m - Device token removed [HTTP 200]

[22] Testing GET /api/users/me/export - Export User Data
[92m✓ PASS[0m - User data exported [HTTP 200]

[23] Testing GET /api/users/{id} - Get User by ID
[92m✓ PASS[0m - User retrieved by ID [HTTP 200]

[96m============================================================================[0m
[96mSECTION 4: MESSAGING ENDPOINTS (9 endpoints)[0m
[96m============================================================================[0m

[24] Testing POST /api/messages - Send New Message
[92m✓ PASS[0m - Message sent successfully [HTTP 201]
  Message ID: 0ee5ce34-b84f-4448-b580-c86b3ce81317

[25] Testing GET /api/messages?conversationWith={userId} - Get Conversation
[92m✓ PASS[0m - Conversation messages retrieved [HTTP 200]

[26] Testing GET /api/messages/search?q=test - Search Messages
[92m✓ PASS[0m - Message search successful [HTTP 200]

[27] Testing GET /api/messages/conversations - Get Conversations List
[92m✓ PASS[0m - Conversations list retrieved [HTTP 200]

[28] Testing POST /api/messages/{id}/read - Mark Message as Read
[92m✓ PASS[0m - Message marked as read [HTTP 200]

[29] Testing POST /api/messages/{id}/delivered - Mark Message as Delivered
[92m✓ PASS[0m - Message marked as delivered [HTTP 200]

[30] Testing PUT /api/messages/{id} - Edit Message
[92m✓ PASS[0m - Message edited successfully [HTTP 200]

[31] Testing DELETE /api/messages/{id} - Delete Message
[92m✓ PASS[0m - Message deleted successfully [HTTP 200]

[32] Testing GET /api/messages/{id}/edit-history - Get Edit History
[93m⚠ CONDITIONAL[0m - Edit history endpoint accessible [HTTP 200]

[96m============================================================================[0m
[96mSECTION 5: CONTACTS ENDPOINTS (6 endpoints)[0m
[96m============================================================================[0m

[33] Testing GET /api/contacts - Get Contacts List
[92m✓ PASS[0m - Contacts list retrieved [HTTP 200]

[34] Testing GET /api/contacts/search?q=test - Search Contacts
[92m✓ PASS[0m - Contact search successful [HTTP 200]

[35] Testing POST /api/contacts - Add Contact
[91m✗ FAIL[0m - Failed to add contact [HTTP 400]

[36] Testing DELETE /api/contacts/{id} - Remove Contact
[93m⊘ SKIP[0m - No contact ID available

[37] Testing POST /api/contacts/{id}/block - Block Contact
[91m✗ FAIL[0m - Failed to block contact [HTTP 404]

[38] Testing POST /api/contacts/{id}/unblock - Unblock Contact
[91m✗ FAIL[0m - Failed to unblock contact [HTTP 404]

[96m============================================================================[0m
[96mSECTION 6: GROUPS ENDPOINTS (9 endpoints)[0m
[96m============================================================================[0m

[39] Testing GET /api/groups - Get User's Groups
[92m✓ PASS[0m - Groups list retrieved [HTTP 200]

[40] Testing POST /api/groups - Create New Group
[92m✓ PASS[0m - Group created successfully [HTTP 201]
  Group ID: b26280b8-0e98-45e9-b1b4-cda5dc1096a5

[41] Testing GET /api/groups/{id} - Get Group Details
[92m✓ PASS[0m - Group details retrieved [HTTP 200]

[42] Testing PUT /api/groups/{id} - Update Group
[91m✗ FAIL[0m - Failed to update group [HTTP 500]

[43] Testing DELETE /api/groups/{id} - Delete Group
[91m✗ FAIL[0m - Failed to delete group [HTTP 500]

[44] Testing POST /api/groups/{id}/members - Add Group Member
[93m⚠ CONDITIONAL[0m - Add member endpoint accessible [HTTP 400]

[45] Testing GET /api/groups/{id}/members - Get Group Members
[93m⚠ CONDITIONAL[0m - Get members endpoint accessible [HTTP 404]

[46] Testing PUT /api/groups/{id}/members/{userId} - Update Member Role
[93m⚠ CONDITIONAL[0m - Update role endpoint accessible [HTTP 404]

[47] Testing DELETE /api/groups/{id}/members/{userId} - Remove Group Member
[93m⚠ CONDITIONAL[0m - Remove member endpoint accessible [HTTP 403]

[96m============================================================================[0m
[96mSECTION 7: CALLS ENDPOINTS (4 endpoints)[0m
[96m============================================================================[0m

[48] Testing POST /api/calls - Initiate Call
[93m⚠ CONDITIONAL[0m - Initiate call endpoint accessible [HTTP 400]

[49] Testing POST /api/calls/{id}/respond - Respond to Call
[93m⚠ CONDITIONAL[0m - Respond to call endpoint accessible [HTTP 404]

[50] Testing GET /api/calls/{id} - Get Call Details
[93m⚠ CONDITIONAL[0m - Get call details endpoint accessible [HTTP 500]

[51] Testing POST /api/calls/{id}/end - End Call
[93m⚠ CONDITIONAL[0m - End call endpoint accessible [HTTP 500]

[96m============================================================================[0m
[96mSECTION 8: FILES ENDPOINTS (8 endpoints)[0m
[96m============================================================================[0m

[52] Testing GET /api/files - List User's Files
[92m✓ PASS[0m - Files list retrieved [HTTP 200]

[53] Testing POST /api/files/upload - Upload File
[91m✗ FAIL[0m - Failed to upload file [HTTP 500]

[54] Testing GET /api/files/{id} - Download File
[93m⊘ SKIP[0m - No file ID available

[55] Testing GET /api/files/{id}/info - Get File Info
[93m⊘ SKIP[0m - No file ID available

[56] Testing GET /api/files/{id}/thumbnail - Get File Thumbnail
[93m⊘ SKIP[0m - No file ID available

[57] Testing DELETE /api/files/{id} - Delete File
[93m⊘ SKIP[0m - No file ID available

[58] Testing GET /api/admin/files - List All Files (Admin)
[93m⊘ SKIP[0m - No admin token available

[59] Testing DELETE /api/admin/files/{id} - Delete File (Admin)
[93m⊘ SKIP[0m - No admin token available

[96m============================================================================[0m
[96mSECTION 9: ENCRYPTION ENDPOINTS (4 endpoints)[0m
[96m============================================================================[0m

[60] Testing POST /api/encryption/keypair - Generate E2E Key Pair
[93m⚠ CONDITIONAL[0m - Generate keypair endpoint accessible [HTTP 201]

[61] Testing GET /api/encryption/publickey/{userId} - Get Public Key
[93m⚠ CONDITIONAL[0m - Get public key endpoint accessible [HTTP 404]

[62] Testing POST /api/encryption/publickeys/batch - Get Batch Public Keys
[93m⚠ CONDITIONAL[0m - Batch public keys endpoint accessible [HTTP 404]

[63] Testing PUT /api/encryption/keypair - Update Key Pair
[93m⚠ CONDITIONAL[0m - Update keypair endpoint accessible [HTTP 404]

[96m============================================================================[0m
[96mSECTION 10: NOTIFICATIONS ENDPOINTS (7 endpoints)[0m
[96m============================================================================[0m

[64] Testing GET /api/notifications - Get User Notifications
[92m✓ PASS[0m - Notifications retrieved [HTTP 200]

[65] Testing GET /api/notifications/unread-count - Get Unread Count
[92m✓ PASS[0m - Unread count retrieved [HTTP 200]

[66] Testing PUT /api/notifications/mark-all-read - Mark All as Read
[91m✗ FAIL[0m - Failed to mark all read [HTTP 500]

[67] Testing PUT /api/notifications/{id}/read - Mark Single as Read
[93m⊘ SKIP[0m - No notification ID available

[68] Testing DELETE /api/notifications/{id} - Delete Notification
[93m⊘ SKIP[0m - No notification ID available

[69] Testing POST /api/admin/notifications - Create Notification (Admin)
[93m⊘ SKIP[0m - No admin token available

[70] Testing DELETE /api/admin/notifications/cleanup - Cleanup Old Notifications
[93m⊘ SKIP[0m - No admin token available

[96m============================================================================[0m
[96mSECTION 11: NOTIFICATION SETTINGS ENDPOINTS (4 endpoints)[0m
[96m============================================================================[0m

[71] Testing GET /api/notification-settings - Get Settings
[92m✓ PASS[0m - Notification settings retrieved [HTTP 200]

[72] Testing PUT /api/notification-settings - Update Settings
[91m✗ FAIL[0m - Failed to update settings [HTTP 500]

[73] Testing POST /api/notification-settings/reset - Reset Settings
[91m✗ FAIL[0m - Failed to reset settings [HTTP 500]

[74] Testing GET /api/notification-settings/preview - Preview Settings
[93m⚠ CONDITIONAL[0m - Preview settings endpoint accessible [HTTP 400]

[96m============================================================================[0m
[96mSECTION 12: ANNOUNCEMENTS ENDPOINTS (1 endpoint)[0m
[96m============================================================================[0m

[75] Testing GET /api/announcements - Get Active Announcements
[91m✗ FAIL[0m - Failed to get announcements [HTTP 000]

[96m============================================================================[0m
[96mSECTION 13: ADMIN ENDPOINTS (30 endpoints - Requires Admin Access)[0m
[96m============================================================================[0m

[Admin] Testing POST /api/auth/login - Admin Login
[91m✗ FAIL[0m - Admin login failed [HTTP 000]

[76] Testing GET /api/admin/stats - Get System Statistics
[93m⊘ SKIP[0m - No admin token available

[77] Testing GET /api/admin/users/pending - Get Pending Users
[93m⊘ SKIP[0m - No admin token available

[78] Testing GET /api/admin/users - Get All Users
[93m⊘ SKIP[0m - No admin token available

[79] Testing GET /api/admin/audit-logs - Get Audit Logs
[93m⊘ SKIP[0m - No admin token available

[80] Testing GET /api/admin/reports - Get Reports
[93m⊘ SKIP[0m - No admin token available

[81] Testing GET /api/admin/settings - Get System Settings
[93m⊘ SKIP[0m - No admin token available

[82] Testing GET /api/admin/announcements - Get Announcements (Admin View)
[93m⊘ SKIP[0m - No admin token available

[83] Testing GET /api/admin/monitoring - Get Monitoring Data
[93m⊘ SKIP[0m - No admin token available

[84] Testing POST /api/admin/users/{id}/approve - Approve User
[93m⊘ SKIP[0m - No admin token available

[85-105] Testing additional admin endpoints...

[85] Admin endpoint 85 - [93m⊘ SKIP[0m (No admin token)
[86] Admin endpoint 86 - [93m⊘ SKIP[0m (No admin token)
[87] Admin endpoint 87 - [93m⊘ SKIP[0m (No admin token)
[88] Admin endpoint 88 - [93m⊘ SKIP[0m (No admin token)
[89] Admin endpoint 89 - [93m⊘ SKIP[0m (No admin token)
[90] Admin endpoint 90 - [93m⊘ SKIP[0m (No admin token)
[91] Admin endpoint 91 - [93m⊘ SKIP[0m (No admin token)
[92] Admin endpoint 92 - [93m⊘ SKIP[0m (No admin token)
[93] Admin endpoint 93 - [93m⊘ SKIP[0m (No admin token)
[94] Admin endpoint 94 - [93m⊘ SKIP[0m (No admin token)
[95] Admin endpoint 95 - [93m⊘ SKIP[0m (No admin token)
[96] Admin endpoint 96 - [93m⊘ SKIP[0m (No admin token)
[97] Admin endpoint 97 - [93m⊘ SKIP[0m (No admin token)
[98] Admin endpoint 98 - [93m⊘ SKIP[0m (No admin token)
[99] Admin endpoint 99 - [93m⊘ SKIP[0m (No admin token)
[100] Admin endpoint 100 - [93m⊘ SKIP[0m (No admin token)
[101] Admin endpoint 101 - [93m⊘ SKIP[0m (No admin token)
[102] Admin endpoint 102 - [93m⊘ SKIP[0m (No admin token)
[103] Admin endpoint 103 - [93m⊘ SKIP[0m (No admin token)
[104] Admin endpoint 104 - [93m⊘ SKIP[0m (No admin token)
[105] Admin endpoint 105 - [93m⊘ SKIP[0m (No admin token)

[96m============================================================================[0m
[96mLOGOUT AND CLEANUP[0m
[96m============================================================================[0m

[Final] Testing POST /api/auth/logout - User Logout
[93m⚠ CONDITIONAL[0m - Logout completed [HTTP 000]

[Admin Final] Testing POST /api/auth/logout - Admin Logout
[93m⊘ SKIP[0m - No admin token available


[94m============================================================================[0m
[94m                        ENHANCED TEST SUMMARY (FIXED)[0m
[94m============================================================================[0m

Total Tests:    108
[92mPassed:         53[0m
[91mFailed:         13[0m
[93mSkipped:        42[0m
Success Rate:   49%

[0m was unexpected at this time.
